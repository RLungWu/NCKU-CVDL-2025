# 🎬 Super Mario RL 影片錄製腳本

> 影片需求：說明修改程式碼的部分及原因，訓練及測試各錄製 10 回合

---

## ✅ 已完成錄製

| 模式 | 影片檔案 | 幀數 | 狀態 |
|------|----------|------|------|
| Extreme | `videos/mario_train_extreme.mp4` | 6,301 | ✅ 完成 |
| Normal | `videos/mario_train_normal.mp4` | 6,915 | ✅ 完成 |

---

## 📹 影片結構（建議總長 5-8 分鐘）

| 段落 | 時長 | 內容 |
|------|------|------|
| 開場 | 30秒 | 自我介紹、專案簡介 |
| 程式碼說明 | 2-3分鐘 | 展示 reward.py 修改內容 |
| 訓練錄影 | 2分鐘 | 展示已錄製的 10 回合訓練過程 |
| 測試錄影 | 1分鐘 | 展示已錄製的測試過程 |
| 結論 | 30秒 | 總結觀察與心得 |

---

## 🎤 第一部分：開場（30 秒）

```
大家好，我是 [你的名字]。
這是 NCKU CVDL 2025 的 Super Mario 強化學習作業。

我的目標是設計獎勵函數，讓 AI 學會「快速通關」。
在這個影片中，我會說明我修改了哪些程式碼，
以及為什麼這樣設計，最後展示訓練和測試的結果。
```

---

## 🎤 第二部分：程式碼修改說明（2-3 分鐘）

### 📌 操作：開啟 reward.py，邊講邊滾動檔案

---

### 2.1 總覽說明（30 秒）

```
首先看 reward.py，這是本次作業的核心。

我總共實作了 16 種獎勵函數：
- 原有的 9 種基本規則
- 新增的 7 種「快速通關」專用規則

讓我分別說明這些修改。
```

---

### 2.2 模式設定（15 秒）

**📌 滾動到第 14 行，顯示 EXTREME_MODE**

```
這裡是模式切換開關。
EXTREME_MODE = True 是極端模式，會放大所有獎勵訊號。
這讓 AI 學得更快，但也更容易過度反應。
```

---

### 2.3 獎勵配置表（45 秒）

**📌 滾動到第 23-48 行，顯示 NORMAL_CONFIG**

```
這是 Normal 模式的獎勵配置表，讓我說明重點：

核心獎勵：
- forward_reward = 30：前進是最重要的，每步給 30 分
- flag_reward = 1000：通關給 1000 分的大獎勵
- speed_bonus = 15：這是我新增的，獎勵快速跑動

核心懲罰：
- death_penalty = -300：死亡扣 300 分，非常嚴重
- backward_penalty = -25：後退扣分
- stagnation_penalty = -20：原地不動扣分

特別注意：
- fall_penalty = 0：下落不扣分，這很重要！
  因為跳躍一定會下落，如果扣分 AI 會不敢跳
```

**📌 滾動到第 56-81 行，顯示 EXTREME_CONFIG**

```
Extreme 模式是策略性放大：
- 核心獎勵放大 3-4 倍（forward: 30→100）
- 核心懲罰放大 2 倍（death: -300→-500）

這不是簡單的 x10，而是有策略地強化重要訊號。
```

---

### 2.4 新增的 7 個獎勵函數（1 分鐘）

**📌 滾動到各個新函數的位置**

```
接下來是我新增的 7 個快速通關獎勵函數。
```

| 函數 | 說明 |
|------|------|
| `speed_bonus_reward` | 快速移動（x_diff > 5）時獎勵，鼓勵跑動 |
| `momentum_bonus_reward` | 連續前進 5 步以上給額外獎勵 |
| `new_distance_record_reward` | 到達本回合最遠位置時獎勵 |
| `obstacle_clear_reward` | 從高處落下且前進時獎勵（跳過障礙）|
| `progress_efficiency_reward` | 進度效率獎勵/懲罰 |
| `precise_jump_reward` | 高跳+前進時獎勵 |
| `perfect_clear_bonus` | 通關時剩餘時間獎勵 |

---

### 2.5 總獎勵計算（15 秒）

**📌 滾動到約第 315 行，顯示 final_reward 函數**

```
最後在 final_reward 函數中，
整合了所有 16 個獎勵函數的結果。
每一步的獎勵就是這些函數的總和。
```

---

## 🎤 第三部分：訓練錄影（2 分鐘）

### 📌 展示已錄製的影片

訓練影片已自動錄製並儲存：
- **Extreme**: `videos/mario_train_extreme.mp4` (6,301 幀)
- **Normal**: `videos/mario_train_normal.mp4` (6,915 幀)

### 3.1 訓練過程講解

```
【Extreme 模式 10 回合訓練結果】
- 回合 1: Reward 28,736
- 回合 4: Reward 35,278 (新最高)
- 回合 9: Reward 36,614 (最佳)

可以看到使用預訓練模型後，
AI 從一開始就有不錯的表現。
Epsilon 從 0.3 降到 0.285，探索率持續下降。

【Normal 模式 10 回合訓練結果】
- 回合 1: Reward 515
- 回合 4: Reward 19,422 (最佳)
- Normal 模式獎勵數值較小，但學習過程類似
```

---

## 🎤 第四部分：測試錄影（1 分鐘）

### 📌 測試影片執行方式

```bash
# 執行測試並錄製影片
python eval.py
# 影片輸出：mario_eval.mp4
```

### 4.1 測試過程講解

```
【觀察重點 1：移動速度】
可以看到 AI 不是慢慢走，而是快速跑動。
這就是 speed_bonus 獎勵的效果。

【觀察重點 2：跳躍行為】
AI 會在適當的時機跳躍避開敵人。
這是因為我們給死亡很大的懲罰 (-500)。

【觀察重點 3：最遠距離】
訓練的模型可以到達 x = 1072。
這已經越過了第一個敵人的位置。
```

---

## 🎤 第五部分：結論（30 秒）

```
總結這次作業：

【程式碼修改】
我在 reward.py 中實作了 16 個獎勵函數，
其中 7 個是專門為快速通關新增的。

關鍵設計有三點：
1. 速度獎勵：讓 AI 學會跑而不是走
2. 動量獎勵：維持連續前進
3. 下落懲罰為零：讓 AI 敢於跳躍

【結果】
- Extreme 模式最佳獎勵：36,614
- Normal 模式最佳獎勵：19,422
- AI 成功越過第一個敵人

以上就是我的作業報告，謝謝觀看。
```

---

## 🎯 快速指令參考

```bash
# 錄製訓練影片（自動儲存到 videos/）
cd ~/Desktop/NCKU-CVDL-2025/SuperMario_SampleCode251218

# Extreme 模式
# 1. 設定 reward.py: EXTREME_MODE = True
# 2. 執行
uv run run.py
# 輸出：videos/mario_train_extreme.mp4

# Normal 模式
# 1. 設定 reward.py: EXTREME_MODE = False
# 2. 執行
uv run run.py
# 輸出：videos/mario_train_normal.mp4

# 測試影片
uv run eval.py
# 輸出：mario_eval.mp4
```

---

## 📊 訓練結果數據

### Extreme 模式 (10 回合)

| 回合 | 獎勵 | Epsilon |
|------|------|---------|
| 1 | 28,736 | 0.298 |
| 2 | 30,973 | 0.297 |
| 3 | 13,269 | 0.296 |
| 4 | 35,278 | 0.294 |
| 5 | 27,168 | 0.293 |
| 6 | 20,070 | 0.291 |
| 7 | 10,549 | 0.290 |
| 8 | 32,090 | 0.288 |
| 9 | **36,614** | 0.287 |
| 10 | 31,124 | 0.285 |

### Normal 模式 (10 回合)

| 回合 | 獎勵 | Epsilon |
|------|------|---------|
| 1 | 515 | 0.298 |
| 2 | 1,637 | 0.297 |
| 3 | 7,232 | 0.296 |
| 4 | **19,422** | 0.294 |
| 5 | 3,883 | 0.293 |
| 6 | 12,767 | 0.291 |
| 7 | 3,331 | 0.290 |
| 8 | 7,094 | 0.288 |
| 9 | 18,992 | 0.287 |
| 10 | 2,232 | 0.285 |
