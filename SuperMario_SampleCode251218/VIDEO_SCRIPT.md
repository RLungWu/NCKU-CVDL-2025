# Super Mario Bros å¼·åŒ–å­¸ç¿’å°ˆæ¡ˆ - å½±ç‰‡è…³æœ¬

## ğŸ“¹ å½±ç‰‡çµæ§‹å»ºè­° (ç´„ 8-10 åˆ†é˜)

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šå°ˆæ¡ˆä»‹ç´¹ (ç´„ 1 åˆ†é˜)

### è¬›ç¨¿ï¼š

å¤§å®¶å¥½ï¼Œé€™æ˜¯æˆ‘çš„ Super Mario Bros å¼·åŒ–å­¸ç¿’å°ˆæ¡ˆå ±å‘Šã€‚

æœ¬å°ˆæ¡ˆä½¿ç”¨ **Deep Q-Network (DQN)** è¨“ç·´ AI ä»£ç†ç©è¶…ç´šç‘ªåˆ©æ­å…„å¼Ÿç¬¬ä¸€é—œã€‚

**å°ˆæ¡ˆé‡é»ï¼š**
- è‡ªå®šç¾©æ™ºæ…§çå‹µç³»çµ±
- å°ˆæ³¨æ–¼**å¹³å‡è¡¨ç¾**è€Œéå–®æ¬¡æœ€ä½³è¡¨ç¾
- ç©©å®šçš„è¨“ç·´ç­–ç•¥

**å°ˆæ¡ˆæ¶æ§‹åŒ…å«ä»¥ä¸‹ç¨‹å¼ç¢¼æª”æ¡ˆï¼š**

| æª”æ¡ˆ | èªªæ˜ |
|------|------|
| `run_parallel.py` | å¹³è¡Œè¨“ç·´è…³æœ¬ (å°ˆæ³¨å¹³å‡è¡¨ç¾) |
| `eval.py` | è©•ä¼°è…³æœ¬ |
| `reward.py` | è‡ªå®šç¾©çå‹µå‡½æ•¸ â­ æ ¸å¿ƒå‰µæ–° |
| `model.py` | CustomCNN ç¥ç¶“ç¶²è·¯ |
| `DQN.py` | DQN æ¼”ç®—æ³•å¯¦ç¾ |
| `utils.py` | å·¥å…·å‡½æ•¸ |

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šCustom Reward å‡½æ•¸è¨­è¨ˆ (ç´„ 2-3 åˆ†é˜)

### è¬›ç¨¿ï¼š

æ¥ä¸‹ä¾†ä»‹ç´¹æˆ‘è¨­è¨ˆçš„è‡ªå®šç¾©çå‹µå‡½æ•¸ï¼Œé€™æ˜¯æœ¬å°ˆæ¡ˆçš„æ ¸å¿ƒå‰µæ–°ã€‚

**è¨­è¨ˆå‹•æ©Ÿï¼š**
åŸå§‹çš„éŠæˆ²çå‹µåªåŒ…å«åˆ†æ•¸è®ŠåŒ–ï¼Œé€™å°æ–¼å­¸ç¿’è¤‡é›œè¡Œç‚ºæ˜¯ä¸å¤ çš„ã€‚
æˆ‘çš„ç›®æ¨™æ˜¯è®“ Mario å­¸æœƒï¼šè·³éæ•µäººã€è·¨è¶Šå‘æ´ã€å¿«é€Ÿå‰é€²ã€‚

**çå‹µå‡½æ•¸æ¶æ§‹ (reward.py)ï¼š**

### 1. é›†ä¸­å¼è¶…åƒæ•¸é…ç½®
```python
REWARD_CONFIG = {
    # === åŸºæœ¬çå‹µ ===
    'coin_reward': 10,              # æ¯å€‹ç¡¬å¹£çš„çå‹µ
    'forward_reward': 1.0,          # å‘å‰ç§»å‹•çš„çå‹µ
    'backward_penalty': -0.01,      # å‘å¾Œç§»å‹•çš„æ‡²ç½°
    'flag_reward': 1000,            # åˆ°é”çµ‚é»æ——å¹Ÿçš„çå‹µ
    
    # === æ•µäººç›¸é—œçå‹µ (é™ä½ä»¥é¿å…éåº¦æ¿€é€²) ===
    'kill_base_reward': 10,         # æ“Šæ®ºæ•µäººçš„åŸºç¤çå‹µ
    'enemy_jump_over_reward': 10,   # è·³éæ•µäººçš„çå‹µ
    
    # === ç”Ÿå­˜çå‹µ ===
    'survival_reward': 0.1,         # æ¯ä¸€æ­¥å­˜æ´»çš„çå‹µ
    
    # === å‘æ´è·¨è¶Šçå‹µ ===
    'hole_crossed_reward': 100,     # æˆåŠŸè·¨è¶Šå‘æ´çš„çå‹µ
    'fall_death_penalty': -200,     # æ‰å…¥å‘æ´æ­»äº¡çš„æ‡²ç½°
    ...
}
```

### 2. NES RAM ç›´æ¥è®€å–
```python
RAM_ADDRESSES = {
    'mario_x_pos': 0x006D,          # Mario è¢å¹•ä¸Š X ä½ç½®
    'mario_floating': 0x001D,       # Mario æ˜¯å¦åœ¨ç©ºä¸­
    'enemy_drawn': [0x000F, ...],   # æ•µäººæ˜¯å¦å­˜åœ¨
    'enemy_x_pos': [0x0087, ...],   # æ•µäºº X ä½ç½®
}
```

**æŠ€è¡“äº®é»ï¼š** æˆ‘ç›´æ¥è®€å– NES æ¨¡æ“¬å™¨çš„ RAM ä¾†ç²å–æ•µäººçš„ç²¾ç¢ºåº§æ¨™ï¼Œ
é€™æ¯”åœ–åƒè­˜åˆ¥æ›´æº–ç¢ºã€æ›´å¿«é€Ÿã€‚

### 3. äº”å¤§é¡çå‹µå‡½æ•¸

| é¡åˆ¥ | å‡½æ•¸ | èªªæ˜ |
|------|------|------|
| åŸºæœ¬çå‹µ | `get_coin_reward()`, `distance_x_offset_reward()` | ç¡¬å¹£ã€å‰é€² |
| æ•µäººç›¸é—œ | `enemy_avoidance_reward()`, `kill_enemy_reward()` | è¿´é¿ã€æ“Šæ®º |
| å‘æ´è·¨è¶Š | `hole_crossing_reward()`, `fall_penalty()` | è·³éå‘æ´ |
| éšœç¤™ç‰©çªç ´ | `obstacle_breakthrough_reward()` | çªç ´æ–°å€åŸŸ |
| æ™ºæ…§è·³èº | `jump_timing_reward()` | æ­£ç¢ºæ™‚æ©Ÿè·³èº |

### 4. å‘æ´ä½ç½®å®šç¾©
```python
LEVEL_1_1_HOLES = [
    (1550, 1584),   # ç¬¬ä¸€å€‹å‘æ´
    (1712, 1744),   # ç¬¬äºŒå€‹å‘æ´
    (2480, 2550),   # ç¬¬ä¸‰å€‹å‘æ´
    (2832, 2896),   # ç¬¬å››å€‹å‘æ´
]
```

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šè¨“ç·´ç­–ç•¥ - å°ˆæ³¨å¹³å‡è¡¨ç¾ (ç´„ 2 åˆ†é˜)

### è¬›ç¨¿ï¼š

æœ¬å°ˆæ¡ˆçš„é—œéµå‰µæ–°ä¹‹ä¸€æ˜¯**å°ˆæ³¨æ–¼å¹³å‡è¡¨ç¾è€Œéå–®æ¬¡æœ€ä½³è¡¨ç¾**ã€‚

**ç‚ºä»€éº¼é€™å¾ˆé‡è¦ï¼Ÿ**

| æ–¹æ³• | å•é¡Œ |
|------|------|
| **ä¿å­˜å–®æ¬¡æœ€ä½³** | å¯èƒ½åªæ˜¯é‹æ°£å¥½ï¼Œä¸ä»£è¡¨ç©©å®š |
| **ä¿å­˜å¹³å‡æœ€ä½³** | ä»£è¡¨æ¨¡å‹çš„ä¸€è‡´æ€§è¡¨ç¾ âœ… |

**å¯¦ç¾æ–¹å¼ï¼š**

```python
# è¨ˆç®—ç§»å‹•å¹³å‡ (æœ€è¿‘ 50 å€‹ episode)
if len(episode_max_x_list) >= 50:
    current_avg_dist = np.mean(episode_max_x_list[-50:])
    
    # åªæœ‰ç•¶å¹³å‡è·é›¢æå‡æ™‚æ‰ä¿å­˜æ¨¡å‹
    if current_avg_dist > best_avg_distance:
        best_avg_distance = current_avg_dist
        torch.save(model, f"best_avg_distance_{best_avg_distance}.pth")
```

**è¨“ç·´é…ç½®ï¼š**
| åƒæ•¸ | å€¼ |
|------|-----|
| å¹³è¡Œç’°å¢ƒ | 8 å€‹ |
| Batch Size | 128 |
| Memory Size | 100,000 |
| è©•ä¼°çª—å£ | æœ€è¿‘ 50 episodes |
| ç¸½ Episodes | 2,000+ |

**é€²åº¦æ¢é¡¯ç¤ºï¼š**
```
Training: 50%|â–ˆâ–ˆâ–ˆâ–ˆ| avg_dist=650, best_avg=720, best_single=1152, Îµ=0.100
```

| æŒ‡æ¨™ | èªªæ˜ |
|------|------|
| `avg_dist` | ç•¶å‰ç§»å‹•å¹³å‡è·é›¢ |
| `best_avg` | æ­·å²æœ€ä½³å¹³å‡è·é›¢ â­ ä¸»è¦æŒ‡æ¨™ |
| `best_single` | æ­·å²æœ€ä½³å–®æ¬¡è·é›¢ (åƒ…åƒè€ƒ) |

---

## ç¬¬å››éƒ¨åˆ†ï¼šè¨“ç·´éç¨‹èˆ‡çµæœ (ç´„ 2 åˆ†é˜)

### è¬›ç¨¿ï¼š

**[æ’­æ”¾è¨“ç·´éŒ„å½±ç‰‡æ®µ]**

è¨“ç·´éç¨‹ä¸­çš„é—œéµè§€å¯Ÿï¼š

1. **å¹³å‡è·é›¢ç©©å®šä¸Šå‡**
   - Episode 50: avg_dist â‰ˆ 300
   - Episode 150: avg_dist â‰ˆ 600
   - Episode 500+: avg_dist â‰ˆ 800+

2. **æ¨¡å‹ä¿å­˜ç­–ç•¥**
   - `best_avg_distance_XXX.pth` - å¹³å‡è·é›¢æœ€é«˜çš„æ¨¡å‹ â­
   - `best_avg_reward_XXX.pth` - å¹³å‡çå‹µæœ€é«˜çš„æ¨¡å‹
   - `checkpoint_ep_XXX.pth` - å®šæœŸå­˜æª”

3. **çå‹µèª¿æ•´æ­·ç¨‹**
   - é™ä½æ“Šæ®ºçå‹µ (é¿å…éåº¦æ¿€é€²)
   - å¢åŠ ç”Ÿå­˜çå‹µæ¬Šé‡
   - å¹³è¡¡å‰é€²èˆ‡å®‰å…¨

---

## ç¬¬äº”éƒ¨åˆ†ï¼šæ¸¬è©¦çµæœå±•ç¤º (ç´„ 1-2 åˆ†é˜)

### è¬›ç¨¿ï¼š

**[æ’­æ”¾æ¸¬è©¦éŒ„å½±]**

ä½¿ç”¨å¹³å‡è·é›¢æœ€ä½³æ¨¡å‹é€²è¡Œæ¸¬è©¦ã€‚

**è©•ä¼°è¨­å®šï¼š**
```python
# eval.py é…ç½®
MODEL_PATH = "ckpt_parallel_average/best_avg_distance_XXX.pth"
TEST_EPSILON = 0.05        # å°æ¢ç´¢ç‡
USE_SOFTMAX_SAMPLING = True  # èˆ‡è¨“ç·´ä¸€è‡´
```

**è§€å¯Ÿåˆ°çš„è¡Œç‚ºï¼š**
1. âœ… Mario èƒ½å¤ **ç©©å®šåœ°**å‘å‰ç§»å‹•
2. âœ… èƒ½å¤ è·³éå¤§éƒ¨åˆ†æ•µäºº
3. âœ… åœ¨å‘æ´å€åŸŸæœ‰è·³èºå˜—è©¦
4. âœ… å¤šæ¬¡æ¸¬è©¦è¡¨ç¾**ä¸€è‡´**

**é—œéµæ•¸æ“šï¼š**
| æŒ‡æ¨™ | å€¼ |
|------|-----|
| å¹³å‡è·é›¢ (10 æ¬¡æ¸¬è©¦) | ~800 |
| æ¨™æº–å·® | è¼ƒä½ (ç©©å®š) |
| æœ€ä½³å–®æ¬¡ | 1000+ |

---

## ç¬¬å…­éƒ¨åˆ†ï¼šè§€å¯Ÿèˆ‡çµè«– (ç´„ 1 åˆ†é˜)

### è¬›ç¨¿ï¼š

**ä¸»è¦è§€å¯Ÿï¼š**

1. **å¹³å‡è¡¨ç¾ vs å–®æ¬¡æœ€ä½³**
   - å°ˆæ³¨æ–¼å¹³å‡è¡¨ç¾å¯ä»¥ç²å¾—æ›´ç©©å®šçš„ç­–ç•¥
   - å–®æ¬¡æœ€ä½³å¯èƒ½åªæ˜¯é‹æ°£ï¼Œä¸å…·ä»£è¡¨æ€§

2. **çå‹µå¡‘å½¢çš„é‡è¦æ€§**
   - éœ€è¦å¹³è¡¡å„ç¨®çå‹µçš„æ¬Šé‡
   - éé«˜çš„æ“Šæ®ºçå‹µæœƒå°è‡´éåº¦æ¿€é€²
   - é©ç•¶çš„ç”Ÿå­˜çå‹µé¼“å‹µè¬¹æ…è¡Œç‚º

3. **RAM è®€å–çš„å„ªå‹¢**
   - ç›´æ¥è®€å–è¨˜æ†¶é«”æ¯”åœ–åƒè­˜åˆ¥æ›´ç²¾ç¢º
   - å¯ä»¥ç²å¾—æ•µäººçš„æº–ç¢ºä½ç½®è³‡è¨Š

4. **è¨“ç·´ç­–ç•¥**
   - ä½¿ç”¨ç§»å‹•å¹³å‡è©•ä¼°æ¨¡å‹å“è³ª
   - å®šæœŸä¿å­˜ checkpoint ä»¥é˜²éæ“¬åˆ
   - å¹³è¡Œç’°å¢ƒåŠ é€Ÿè¨“ç·´

**ç¸½çµï¼š**
é€éç²¾å¿ƒè¨­è¨ˆçš„çå‹µå‡½æ•¸å’Œå°ˆæ³¨æ–¼å¹³å‡è¡¨ç¾çš„è¨“ç·´ç­–ç•¥ï¼Œ
æˆ‘å€‘æˆåŠŸè¨“ç·´å‡ºèƒ½å¤ **ç©©å®š**é€šé Super Mario Bros 1-1 é—œå¡çš„ AIã€‚

è¬è¬è§€çœ‹ï¼

---

## ğŸ“¦ ç¹³äº¤æª”æ¡ˆæ¸…å–®

### ç¨‹å¼ç¢¼ (6 å€‹æª”æ¡ˆ)
1. `run_parallel.py` - å¹³è¡Œè¨“ç·´è…³æœ¬ (å°ˆæ³¨å¹³å‡è¡¨ç¾)
2. `eval.py` - è©•ä¼°è…³æœ¬
3. `reward.py` - è‡ªå®šç¾©çå‹µå‡½æ•¸ â­
4. `model.py` - ç¥ç¶“ç¶²è·¯æ¶æ§‹
5. `DQN.py` - DQN æ¼”ç®—æ³•
6. `utils.py` - å·¥å…·å‡½æ•¸

### æ¬Šé‡æª” (1 å€‹)
- `best_avg_distance_XXX.pth` - å¹³å‡è·é›¢æœ€ä½³æ¨¡å‹ ğŸ†

### å½±ç‰‡ (1 å€‹)
- åŒ…å«ä»¥ä¸Šæ‰€æœ‰è¬›è§£å…§å®¹
- è¨“ç·´éç¨‹éŒ„å½±
- æ¸¬è©¦éç¨‹éŒ„å½±

---

## ğŸ¬ éŒ„å½±å»ºè­°

1. **è¢å¹•éŒ„è£½è»Ÿé«”**: OBS Studio æˆ– Kazam (Linux)
   ```bash
   sudo apt install kazam
   ```

2. **è¨“ç·´éŒ„å½±**: å±•ç¤ºè¨“ç·´é€²åº¦å’Œå¹³å‡æŒ‡æ¨™
   ```bash
   uv run python run_parallel.py
   ```

3. **æ¸¬è©¦éŒ„å½±**: å¤šæ¬¡æ¸¬è©¦å±•ç¤ºç©©å®šæ€§
   ```bash
   uv run python eval.py
   ```

---

## ğŸ“ é‡è¦ç¨‹å¼ç¢¼æ®µè½å±•ç¤º

### 1. å°ˆæ³¨å¹³å‡è¡¨ç¾çš„æ¨¡å‹ä¿å­˜
```python
# è¨ˆç®—ç§»å‹•å¹³å‡ (æœ€è¿‘ 50 å€‹ episode)
if len(episode_max_x_list) >= 50:
    current_avg_dist = np.mean(episode_max_x_list[-50:])
    
    # åªæœ‰ç•¶å¹³å‡è·é›¢æå‡æ™‚æ‰ä¿å­˜æ¨¡å‹
    if current_avg_dist > best_avg_distance:
        best_avg_distance = current_avg_dist
        model_path = f"best_avg_distance_{int(best_avg_distance)}.pth"
        torch.save(dqn.q_net.state_dict(), model_path)
        print(f"ğŸ“Š New best AVG distance: {best_avg_distance:.0f}")
```

### 2. çå‹µé…ç½® (å¹³è¡¡ç‰ˆ)
```python
REWARD_CONFIG = {
    'forward_reward': 1.0,          # é©ä¸­çš„å‰é€²çå‹µ
    'kill_base_reward': 10,         # é™ä½çš„æ“Šæ®ºçå‹µ
    'survival_reward': 0.1,         # å­˜æ´»çå‹µ
    'hole_crossed_reward': 100,     # é‡è¦çš„å‘æ´çå‹µ
}
```

### 3. é€²åº¦æ¢å°ˆæ³¨æ–¼å¹³å‡å€¼
```python
pbar.set_postfix({
    'avg_dist': f'{avg_max_x:.0f}',       # ç•¶å‰å¹³å‡
    'best_avg': f'{best_avg_distance:.0f}', # æœ€ä½³å¹³å‡ â­
    'best_single': f'{best_max_x:.0f}',   # å–®æ¬¡æœ€ä½³ (åƒè€ƒ)
})
```

---

## ğŸ¯ æ™‚é–“åˆ†é…å»ºè­°

| æ®µè½ | æ™‚é–“ | å…§å®¹ |
|------|------|------|
| å°ˆæ¡ˆä»‹ç´¹ | 1 åˆ†é˜ | æ¶æ§‹ã€æª”æ¡ˆèªªæ˜ |
| Reward è¨­è¨ˆ | 2-3 åˆ†é˜ | æ ¸å¿ƒå‰µæ–° â­ |
| è¨“ç·´ç­–ç•¥ | 2 åˆ†é˜ | å¹³å‡è¡¨ç¾å°å‘ â­ |
| è¨“ç·´éç¨‹ | 2 åˆ†é˜ | éŒ„å½±ã€çµæœ |
| æ¸¬è©¦å±•ç¤º | 1-2 åˆ†é˜ | ç©©å®šæ€§å±•ç¤º |
| çµè«– | 1 åˆ†é˜ | è§€å¯Ÿã€ç¸½çµ |
| **ç¸½è¨ˆ** | **8-10 åˆ†é˜** | |
